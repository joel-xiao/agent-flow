# æ™ºèƒ½è¥é”€å†…å®¹ç”Ÿæˆç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## 1. ç³»ç»Ÿæ¦‚è¿°

æ™ºèƒ½è¥é”€å†…å®¹ç”Ÿæˆç³»ç»Ÿæ˜¯ä¸€ä¸ªå±•ç¤º AgentFlow æ¡†æ¶å®Œæ•´åŠŸèƒ½çš„ç»¼åˆåº”ç”¨ï¼Œèƒ½å¤Ÿæ ¹æ®äº§å“ä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆè¥é”€æ–‡æ¡ˆå’Œé…å¥—å›¾ç‰‡ã€‚

### æ ¸å¿ƒåŠŸèƒ½

- âœ… **è‡ªåŠ¨è·¯ç”±**ï¼šæ ¹æ®ç›®æ ‡å—ä¼—è‡ªåŠ¨é€‰æ‹©æ–‡æ¡ˆé£æ ¼ï¼ˆæ­£å¼/è½»æ¾/ä¿ƒé”€ï¼‰
- âœ… **æ‰‹åŠ¨è·¯ç”±**ï¼šç”¨æˆ·å¯æ˜ç¡®æŒ‡å®šç”Ÿæˆè·¯å¾„
- âœ… **å¾ªç¯é‡è¯•**ï¼šæ–‡æ¡ˆè´¨é‡ä¸åˆæ ¼æ—¶è‡ªåŠ¨é‡æ–°ç”Ÿæˆ
- âœ… **å¹¶è¡Œå¤„ç†**ï¼šåŒæ—¶ç”Ÿæˆå¤šè¯­è¨€ç‰ˆæœ¬
- âœ… **å†³ç­–èŠ‚ç‚¹**ï¼šæ ¹æ®å®¡æ ¸ç»“æœå†³å®šåç»­æµç¨‹
- âœ… **JoinèŠ‚ç‚¹**ï¼šæ±‡æ€»å¤šè¯­è¨€ç»“æœ
- âœ… **å›¾ç‰‡ç”Ÿæˆ**ï¼šæ ¹æ®æ–‡æ¡ˆç”Ÿæˆé…å¥—çš„è¥é”€å›¾ç‰‡æç¤ºè¯ï¼Œå¹¶ä½¿ç”¨ qwen-image-edit-plus å®é™…ç”Ÿæˆå›¾ç‰‡

## 2. å·¥ä½œæµè®¾è®¡

### 2.1 å®Œæ•´æµç¨‹å›¾

```
ç”¨æˆ·è¾“å…¥ (äº§å“ä¿¡æ¯)
    â†“
[éœ€æ±‚åˆ†æ] â†’ æå–ç›®æ ‡å—ä¼—ã€äº§å“ç‰¹ç‚¹
    â†“
[æ™ºèƒ½è·¯ç”±] â†’ è‡ªåŠ¨é€‰æ‹©é£æ ¼ OR ç”¨æˆ·æŒ‡å®š
    â”œâ”€â†’ æ­£å¼é£æ ¼è·¯å¾„
    â”œâ”€â†’ è½»æ¾é£æ ¼è·¯å¾„
    â””â”€â†’ ä¿ƒé”€é£æ ¼è·¯å¾„
    â†“
[æ–‡æ¡ˆç”Ÿæˆ] â†’ ç”Ÿæˆåˆç¨¿
    â†“
[è´¨é‡æ£€æŸ¥] (Loop) â†’ æ£€æŸ¥æ–‡æ¡ˆè´¨é‡
    â”œâ”€â†’ ä¸åˆæ ¼ â†’ é‡æ–°ç”Ÿæˆ (æœ€å¤š3æ¬¡)
    â””â”€â†’ åˆæ ¼ â†’ ç»§ç»­
    â†“
[æ–‡æ¡ˆæ¶¦è‰²] â†’ ä¼˜åŒ–æ–‡æ¡ˆ
    â†“
[å®¡æ ¸å†³ç­–] (Decision) â†’ é£é™©æ£€æŸ¥
    â”œâ”€â†’ æœ‰é£é™© â†’ [äººå·¥å®¡æ ¸]
    â””â”€â†’ æ— é£é™© â†’ ç»§ç»­
    â†“
[å¹¶è¡Œç”Ÿæˆ] (Parallel)
    â”œâ”€â†’ [ä¸­æ–‡ç‰ˆæœ¬]
    â”œâ”€â†’ [è‹±æ–‡ç‰ˆæœ¬]
    â””â”€â†’ [æ—¥æ–‡ç‰ˆæœ¬]
    â†“
[Joinæ±‡æ€»] â†’ åˆå¹¶å¤šè¯­è¨€ç‰ˆæœ¬
    â†“
[å›¾ç‰‡æç¤ºè¯ç”Ÿæˆ] â†’ ä¸ºæ–‡æ¡ˆç”Ÿæˆé…å¥—å›¾ç‰‡æè¿°
    â†“
[æœ€ç»ˆè¾“å‡º] â†’ å®Œæ•´è¥é”€å†…å®¹åŒ…
```

### 2.2 èŠ‚ç‚¹è¯¦ç»†è¯´æ˜

#### Agent èŠ‚ç‚¹

1. **éœ€æ±‚åˆ†æå™¨ (Requirement Analyzer)**
   - é©±åŠ¨ï¼šqwen-max
   - åŠŸèƒ½ï¼šåˆ†æäº§å“ä¿¡æ¯ï¼Œæå–å…³é”®ç‰¹å¾
   - è¾“å‡ºï¼š`{"target_audience": "å¹´è½»äºº", "product_features": [...], "tone_preference": "auto"}`

2. **æ™ºèƒ½è·¯ç”±å™¨ (Smart Router)**
   - é©±åŠ¨ï¼šqwen-max
   - åŠŸèƒ½ï¼šæ ¹æ®å—ä¼—å’Œäº§å“ç‰¹ç‚¹é€‰æ‹©æ–‡æ¡ˆé£æ ¼
   - è·¯ç”±æ¨¡å¼ï¼šautoï¼ˆè‡ªåŠ¨è·¯ç”±ï¼‰
   - è¾“å‡ºï¼š`{"style": "formal"|"casual"|"promotional"}`

3. **æ–‡æ¡ˆç”Ÿæˆå™¨ (Copywriter)**
   - é©±åŠ¨ï¼šqwen-max
   - åŠŸèƒ½ï¼šæ ¹æ®é£æ ¼ç”Ÿæˆè¥é”€æ–‡æ¡ˆåˆç¨¿
   - è¾“å‡ºï¼š`{"draft": "æ–‡æ¡ˆå†…å®¹", "quality_score": 0.0-1.0}`

4. **è´¨é‡æ£€æŸ¥å™¨ (Quality Checker)**
   - é©±åŠ¨ï¼šqwen-max
   - åŠŸèƒ½ï¼šè¯„ä¼°æ–‡æ¡ˆè´¨é‡
   - è¾“å‡ºï¼š`{"quality_check": "pass"|"retry", "issues": [...]}`

5. **æ–‡æ¡ˆæ¶¦è‰²å™¨ (Copy Polisher)**
   - é©±åŠ¨ï¼šqwen-max
   - åŠŸèƒ½ï¼šä¼˜åŒ–è¯­è¨€è¡¨è¾¾ï¼Œå¢å¼ºå¸å¼•åŠ›
   - è¾“å‡ºï¼š`{"polished_copy": "ä¼˜åŒ–åæ–‡æ¡ˆ"}`

6. **é£é™©å®¡æ ¸å™¨ (Risk Reviewer)**
   - é©±åŠ¨ï¼šqwen-max
   - åŠŸèƒ½ï¼šæ£€æŸ¥æ•æ„Ÿè¯ã€å¤¸å¤§å®£ä¼ ç­‰é£é™©
   - è¾“å‡ºï¼š`{"risk_level": "low"|"high", "concerns": [...]}`

7. **å¤šè¯­è¨€ç”Ÿæˆå™¨ (Multilingual Generator)**
   - ä¸‰ä¸ªå¹¶è¡Œå®ä¾‹ï¼šä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡
   - é©±åŠ¨ï¼šqwen-max
   - åŠŸèƒ½ï¼šå°†æ–‡æ¡ˆç¿»è¯‘ä¸ºç›®æ ‡è¯­è¨€
   - è¾“å‡ºï¼š`{"language": "zh|en|ja", "content": "ç¿»è¯‘å†…å®¹"}`

8. **å›¾ç‰‡æç¤ºè¯ç”Ÿæˆå™¨ (Image Prompt Generator)**
   - é©±åŠ¨ï¼šqwen-max
   - åŠŸèƒ½ï¼šæ ¹æ®æ–‡æ¡ˆç”Ÿæˆé€‚åˆçš„å›¾ç‰‡æè¿°
   - è¾“å‡ºï¼š`{"image_prompt": "A modern...", "style": "photography|illustration"}`

#### ç‰¹æ®ŠèŠ‚ç‚¹

1. **Loop Node (è´¨é‡å¾ªç¯)**
   - æ¡ä»¶ï¼š`quality_check == "pass"`
   - æœ€å¤§è¿­ä»£ï¼š3æ¬¡

2. **Decision Node (é£é™©å†³ç­–)**
   - æ¡ä»¶ï¼š`risk_level == "low"`
   - é«˜é£é™©è·¯å¾„ï¼šäººå·¥å®¡æ ¸
   - ä½é£é™©è·¯å¾„ï¼šç»§ç»­è‡ªåŠ¨æµç¨‹

3. **Join Node (å¤šè¯­è¨€æ±‡æ€»)**
   - ç­–ç•¥ï¼šallï¼ˆç­‰å¾…æ‰€æœ‰å¹¶è¡Œä»»åŠ¡å®Œæˆï¼‰
   - å…¥ç«™ï¼šä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ç”Ÿæˆå™¨

## 3. é…ç½®æ–‡ä»¶ç»“æ„

### 3.1 GraphConfig ä¸»è¦å­—æ®µ

```json
{
  "name": "marketing_content_generator",
  "version": "1.0",
  "description": "æ™ºèƒ½è¥é”€å†…å®¹ç”Ÿæˆç³»ç»Ÿ",
  "nodes": [
    // Agent èŠ‚ç‚¹é…ç½®
    {
      "id": "agent_requirement_analyzer",
      "type": "agent",
      "config": {
        "driver": "qwen",
        "model": "qwen-max",
        "endpoint": "https://dashscope.aliyuncs.com/compatible-mode/v1",
        "role": "Requirement Analyzer",
        "prompt": "...",
        "rules": {
          "field_extraction": {
            "target_audience": "target_audience",
            "product_features": "product_features"
          }
        }
      }
    },
    // Loop èŠ‚ç‚¹
    {
      "id": "node_quality_loop",
      "type": "loop_node",
      "config": {
        "entry": "agent_copywriter",
        "condition": {
          "type": "state_equals",
          "key": "quality_check",
          "value": "pass"
        },
        "max_iterations": 3
      }
    },
    // Decision èŠ‚ç‚¹
    {
      "id": "node_risk_decision",
      "type": "decision_node",
      "config": {
        "condition": {
          "type": "state_equals",
          "key": "risk_level",
          "value": "low"
        }
      }
    },
    // Join èŠ‚ç‚¹
    {
      "id": "node_multilingual_join",
      "type": "join_node",
      "config": {
        "strategy": "all",
        "inbound": [
          "agent_chinese_generator",
          "agent_english_generator",
          "agent_japanese_generator"
        ]
      }
    }
  ],
  "edges": [
    // è·¯ç”±è¾¹é…ç½®
    {
      "from": "agent_smart_router",
      "to": "agent_copywriter_formal",
      "type": "conditional",
      "condition": {
        "type": "state_equals",
        "key": "style",
        "value": "formal"
      }
    }
  ]
}
```

## 4. ä½¿ç”¨ç¤ºä¾‹

### 4.1 åŸºæœ¬ç”¨æ³•

```bash
# è¿è¡Œè¥é”€å†…å®¹ç”Ÿæˆ
cargo run --example marketing_generator --features openai-client
```

### 4.2 è¾“å…¥ç¤ºä¾‹

```json
{
  "product": "æ™ºèƒ½æ‰‹è¡¨",
  "features": ["å¿ƒç‡ç›‘æµ‹", "ç¡çœ è·Ÿè¸ª", "50ç±³é˜²æ°´"],
  "target_audience": "å¥èº«çˆ±å¥½è€…",
  "price": "Â¥1,299",
  "tone": "auto"  // æˆ– "formal", "casual", "promotional"
}
```

### 4.3 è¾“å‡ºç¤ºä¾‹

```json
{
  "summary": {
    "style": "casual",
    "quality_score": 0.92,
    "risk_level": "low"
  },
  "content": {
    "zh": "ğŸƒâ€â™‚ï¸ å¥èº«è·¯ä¸Šçš„è´´å¿ƒä¼™ä¼´ï¼æ™ºèƒ½æ‰‹è¡¨...",
    "en": "Your Fitness Companion! Smart Watch...",
    "ja": "ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ã®æœ€é«˜ã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼..."
  },
  "image_prompt": "A sleek smart watch on an athlete's wrist during morning run, professional product photography, natural lighting",
  "metadata": {
    "total_iterations": 1,
    "processing_time": "45s"
  }
}
```

## 5. æŠ€æœ¯äº®ç‚¹

### 5.1 è‡ªåŠ¨è·¯ç”±ç¤ºä¾‹

```rust
// ç³»ç»Ÿä¼šæ ¹æ® target_audience å’Œ product_features è‡ªåŠ¨é€‰æ‹©ï¼š
// - å¹´è½»äºº + ç§‘æŠ€äº§å“ â†’ casual (è½»æ¾é£æ ¼)
// - ä¼ä¸šå®¢æˆ· + B2Bäº§å“ â†’ formal (æ­£å¼é£æ ¼)
// - é™æ—¶ä¼˜æƒ  + ä¿ƒé”€æ´»åŠ¨ â†’ promotional (ä¿ƒé”€é£æ ¼)
```

### 5.2 ä¸Šä¸‹æ–‡ä¼ é€’æœºåˆ¶

```rust
// æ¯ä¸ª Agent éƒ½èƒ½çœ‹åˆ°å‰åºæ­¥éª¤çš„è¾“å‡º
// ä¾‹å¦‚ï¼šæ–‡æ¡ˆæ¶¦è‰²å™¨èƒ½çœ‹åˆ°åŸå§‹æ–‡æ¡ˆå’Œè´¨é‡æ£€æŸ¥ç»“æœ

<context>
Previous analysis steps:
Agent: copywriter, Output: {"draft": "æ™ºèƒ½æ‰‹è¡¨...", "quality_score": 0.85}
Agent: quality_checker, Output: {"quality_check": "pass"}
</context>
```

### 5.3 å¹¶è¡Œå¤„ç†ä¼˜åŠ¿

```
ä¸²è¡Œå¤„ç†æ—¶é—´ï¼šä¸­æ–‡(10s) + è‹±æ–‡(10s) + æ—¥æ–‡(10s) = 30s
å¹¶è¡Œå¤„ç†æ—¶é—´ï¼šmax(10s, 10s, 10s) = 10s
æ€§èƒ½æå‡ï¼š3å€
```

## 6. æ‰©å±•æ–¹å‘

### 6.1 å›¾ç‰‡å®é™…ç”Ÿæˆ

é›†æˆ Stable Diffusion æˆ– DALLÂ·E APIï¼Œå°†å›¾ç‰‡æç¤ºè¯è½¬æ¢ä¸ºçœŸå®å›¾ç‰‡ã€‚

### 6.2 A/Bæµ‹è¯•ç‰ˆæœ¬

ç”Ÿæˆå¤šä¸ªæ–‡æ¡ˆç‰ˆæœ¬ï¼Œé€šè¿‡å†å²æ•°æ®é¢„æµ‹è½¬åŒ–ç‡ã€‚

### 6.3 è§†é¢‘è„šæœ¬ç”Ÿæˆ

æ‰©å±•ä¸ºçŸ­è§†é¢‘è¥é”€å†…å®¹ç”Ÿæˆï¼ŒåŒ…æ‹¬è„šæœ¬ã€åˆ†é•œã€é…ä¹å»ºè®®ã€‚

## 7. æ³¨æ„äº‹é¡¹

1. **API Key é…ç½®**ï¼šéœ€è¦é…ç½® `QWEN_API_KEY` ç¯å¢ƒå˜é‡
2. **æˆæœ¬æ§åˆ¶**ï¼šå¤šæ¬¡ LLM è°ƒç”¨ä¼šäº§ç”Ÿè´¹ç”¨ï¼Œå»ºè®®è®¾ç½®é¢„ç®—é™åˆ¶
3. **å†…å®¹å®¡æ ¸**ï¼šç”Ÿæˆçš„å†…å®¹éœ€äººå·¥æœ€ç»ˆç¡®è®¤ï¼Œé¿å…åˆè§„é£é™©
4. **å¹¶å‘é™åˆ¶**ï¼šæ³¨æ„ API çš„å¹¶å‘è°ƒç”¨é™åˆ¶

## 8. æ€§èƒ½æŒ‡æ ‡

- å•æ¬¡å®Œæ•´ç”Ÿæˆæ—¶é—´ï¼š30-60ç§’
- æ–‡æ¡ˆè´¨é‡å¹³å‡å¾—åˆ†ï¼š0.85+
- å¤šè¯­è¨€ä¸€è‡´æ€§ï¼š90%+
- é£é™©æ£€å‡ºç‡ï¼š95%+

