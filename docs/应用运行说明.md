# 食物识别分析应用运行说明

## 配置完成

✅ **API Key 已配置**
- 配置文件：`configs/graph_config_food_analysis.json`
- API Key：`sk-ede615cd70004d8ab45f8a73b50c42ee`
- 所有 Agent 和 Service 节点已使用该 API Key

✅ **配置文件验证通过**
- JSON 格式正确
- 节点数量：27 个
- 边数量：16 条
- 工作流节点：已找到
- Agent 节点：11 个
- Service 节点：1 个

## 运行步骤

### 1. 确保依赖已安装

```bash
# 检查 Rust 环境
rustc --version
cargo --version

# 如果需要，更新依赖
cargo update
```

### 2. 编译应用

```bash
# 编译示例应用（包含 openai-client 特性）
cargo build --example food_analysis_app --features openai-client
```

### 3. 运行应用

```bash
# 直接运行
cargo run --example food_analysis_app --features openai-client
```

## 应用功能

应用将执行以下工作流：

1. **图像预处理** - 分析图片格式和质量
2. **食物识别** - 使用 qwen-vl-max 模型识别食物
3. **智能路由** - 根据图片质量自动选择处理路径
4. **决策路由** - 根据食物数量选择单食物/多食物路径
5. **分量分析** - 估算食物重量、体积、数量
6. **卡路里计算** - 计算营养成分和卡路里
7. **结果汇总** - 生成结构化报告

## 输入格式

应用期望的输入消息格式：

```json
{
  "user": "User",
  "goal": "Analyze food in this image",
  "image_url": "https://example.com/food.jpg",
  "image_base64": null,
  "steps": []
}
```

## 输出格式

应用将输出 JSON 格式的分析结果：

```json
{
  "analysis_id": "id",
  "timestamp": "ISO8601",
  "foods": [
    {
      "name": "apple",
      "confidence": 0.95,
      "portion": {
        "weight": 150,
        "unit": "g"
      },
      "nutrition": {
        "calories": 75,
        "protein": 0.5,
        "carbs": 19.5,
        "fat": 0.3
      }
    }
  ],
  "summary": {
    "total_calories": 75,
    "total_foods": 1,
    "confidence_score": 0.95
  }
}
```

## 使用的模型

根据您的模型选择，应用使用：

- **视觉模型**：`qwen-vl-max` 或 `qwen3-vl-plus`（用于图像识别）
- **文本模型**：`qwen-max` 或 `qwen-plus-2025-07-28`（用于分析和计算）

## 故障排除

### 网络问题

如果遇到依赖下载问题：

```bash
# 检查网络连接
ping mirrors.bfsu.edu.cn

# 或者使用官方源（修改 ~/.cargo/config.toml）
```

### API Key 问题

如果遇到 API 认证错误：

1. 检查 API Key 是否正确
2. 检查 API Key 是否有效
3. 检查账户余额和配额

### 编译错误

如果遇到编译错误：

```bash
# 清理并重新编译
cargo clean
cargo build --example food_analysis_app --features openai-client
```

## 下一步

1. 运行应用并测试基本功能
2. 根据实际需求调整 Agent 的 prompt
3. 优化工作流配置
4. 添加错误处理和重试机制
5. 集成真实的图片输入

## 相关文档

- [食物识别分析应用设计](./食物识别分析应用设计.md) - 完整设计文档
- [项目文件结构说明](./项目文件结构说明.md) - 项目结构说明
- [路由和编排功能说明](./路由和编排功能说明.md) - 路由功能说明

