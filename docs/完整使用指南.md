# 智能营销内容生成系统 - 完整使用指南

## 🚀 快速开始

### 步骤1：生成营销内容和图片提示词

```bash
# 设置API Key
export QWEN_API_KEY=your_api_key_here

# 运行营销内容生成系统
cd /path/to/agentflow
cargo run --example marketing_generator --features openai-client
```

**输出示例：**
```
✅ 营销内容生成完成!

📊 最终分析结果:
{
  "summary": {
    "style": "promotional",
    "quality_score": 0.9,
    "risk_level": "low"
  },
  "content": {
    "zh": "用我们的尖端解决方案，充分释放您的营销活动潜力...",
    "en": "Unlock the full potential of your marketing campaigns...",
    "ja": "日本語のマーケティングコピー"
  },
  "image_prompt": "A modern, sleek office setting with a professional marketing team gathered around a large, high-resolution computer screen...",
  "metadata": {
    "total_iterations": 2
  }
}
```

### 步骤2：生成营销图片（三种方法）

#### 方法一：通义万相网页版（最简单）⭐

1. 打开：https://tongyi.aliyun.com/wanxiang/
2. 复制上面的 `image_prompt` 内容
3. 粘贴到输入框，点击生成
4. 等待30秒，下载图片

**优点：** 无需编程，界面友好  
**缺点：** 需要手动操作

#### 方法二：Python脚本（推荐）⭐⭐

```bash
# 安装依赖
pip install dashscope

# 设置API Key
export DASHSCOPE_API_KEY=your_api_key_here

# 方式1：直接提供提示词
python scripts/generate_marketing_image.py "A modern, sleek office setting..."

# 方式2：从JSON文件提取（自动化）
cargo run --example marketing_generator --features openai-client > result.json
python scripts/generate_marketing_image.py --from-json result.json

# 生成多张图片
python scripts/generate_marketing_image.py "提示词" -n 4

# 指定尺寸
python scripts/generate_marketing_image.py "提示词" --size 720*1280
```

**输出示例：**
```
🎨 正在生成图片...
📝 提示词: A modern, sleek office setting...
📐 尺寸: 1024*1024
🔢 数量: 1

✅ 图片生成成功！

🖼️  图片 1: https://dashscope-result-bj.oss-cn-beijing.aliyuncs.com/xxx.png
```

**优点：** 可自动化，支持批量  
**缺点：** 需要Python环境

#### 方法三：一键完整流程（最自动化）⭐⭐⭐

创建 Shell 脚本 `scripts/generate_full_marketing.sh`:

```bash
#!/bin/bash
set -e

echo "🚀 开始生成完整营销内容包..."

# 1. 生成文案和提示词
echo "📝 生成营销文案..."
cargo run --example marketing_generator --features openai-client > result.json

# 2. 提取图片提示词并生成图片
echo "🎨 生成营销图片..."
python scripts/generate_marketing_image.py --from-json result.json --output images.json

# 3. 合并结果
echo "📦 打包结果..."
jq -s '.[0] * .[1]' result.json images.json > final_result.json

echo "✅ 完成！查看 final_result.json"
echo ""
echo "📄 文案："
jq -r '.content.zh' final_result.json | head -c 200
echo "..."
echo ""
echo "🖼️  图片："
jq -r '.images[].url' final_result.json
```

使用：
```bash
chmod +x scripts/generate_full_marketing.sh
./scripts/generate_full_marketing.sh
```

## 📋 完整功能演示

### 1. 自动路由

系统会根据产品特点自动选择文案风格：

```rust
// 示例：修改产品信息
let product_info = serde_json::json!({
    "product": {
        "name": "企业级CRM系统",  // B2B产品
        "target_market": "企业决策者"
    },
    "requirements": {
        "tone": "auto"  // 自动选择
    }
});
```

**结果：** 系统会自动选择 `formal`（正式风格）

### 2. 手动路由

显式指定文案风格：

```rust
"requirements": {
    "tone": "casual"  // 强制使用轻松风格
}
```

支持的风格：
- `formal` - 正式、专业，适合B2B
- `casual` - 轻松、友好，适合年轻消费者
- `promotional` - 促销、激进，适合限时优惠

### 3. 并行多语言生成

系统自动并行生成三种语言：

```
[Chinese Generator]    ─┐
                        ├─→ [Join Node] → 继续
[English Generator]    ─┤
                        │
[Japanese Generator]   ─┘

时间：max(10s, 10s, 10s) = 10s（而不是30s）
```

### 4. 自定义产品信息

编辑 `examples/marketing_generator.rs`:

```rust
let product_info = serde_json::json!({
    "product": {
        "name": "您的产品名称",
        "category": "产品类别",
        "features": [
            "核心功能1",
            "核心功能2",
            "核心功能3"
        ],
        "price": "¥999",
        "target_market": "目标客户群体"
    },
    "requirements": {
        "tone": "auto",
        "languages": ["zh", "en", "ja"],
        "include_image_prompt": true
    }
});
```

## 🎯 使用场景

### 场景1：电商产品发布

```bash
# 1. 修改产品信息为电商产品
# 2. 运行系统
cargo run --example marketing_generator --features openai-client

# 3. 使用生成的文案作为商品详情页
# 4. 使用图片提示词生成商品展示图
```

### 场景2：社交媒体营销

```bash
# 1. 设置 tone 为 "casual"
# 2. 生成轻松风格文案
# 3. 生成配套图片
# 4. 发布到社交媒体平台
```

### 场景3：B2B产品手册

```bash
# 1. 设置 tone 为 "formal"
# 2. 生成专业文案（多语言）
# 3. 生成产品演示图
# 4. 制作产品手册/PPT
```

### 场景4：批量处理

```python
# batch_generate.py
import subprocess
import json

products = [
    {"name": "产品A", "target": "年轻人"},
    {"name": "产品B", "target": "企业"},
    {"name": "产品C", "target": "家庭"},
]

for product in products:
    # 1. 更新配置
    # 2. 运行生成
    # 3. 保存结果
    pass
```

## ⚙️ 高级配置

### 调整Agent参数

编辑 `configs/graph_config_marketing_generator.json`:

```json
{
  "id": "agent_copywriter",
  "config": {
    "model": "qwen-max",
    "temperature": 0.8,  // 创意度：0.0-1.0
    "max_tokens": 2000,  // 最大输出长度
    "prompt": "自定义提示词..."
  }
}
```

### 添加新的语言

```json
{
  "id": "agent_korean_generator",
  "type": "agent",
  "config": {
    "name": "korean_generator",
    "driver": "qwen",
    "model": "qwen-max",
    "prompt": "Translate to Korean...",
    "intent": "generate_korean"
  }
},
// 添加到 Join 节点的 inbound
{
  "id": "node_multilingual_join",
  "config": {
    "inbound": [
      "agent_chinese_generator",
      "agent_english_generator",
      "agent_japanese_generator",
      "agent_korean_generator"  // 新增
    ]
  }
}
```

### 调整上下文窗口

```json
{
  "id": "agent_result_summarizer",
  "config": {
    "rules": {
      "prompt_building": {
        "max_history_items": 5  // 增加上下文数量
      }
    }
  }
}
```

## 📊 性能优化

### 减少API调用

```json
// 跳过风险审核（如果内容安全可控）
// 删除或注释掉 agent_risk_reviewer 相关配置

// 减少语言版本
"languages": ["zh"]  // 只生成中文
```

### 加速生成

```rust
// 使用更快的模型
"model": "qwen-turbo"  // 代替 qwen-max

// 减少 max_tokens
"max_tokens": 500  // 减少输出长度
```

### 本地缓存

```bash
# 缓存常用提示词
mkdir -p cache/prompts

# 保存结果避免重复生成
cargo run --example marketing_generator > cache/result_$(date +%Y%m%d_%H%M%S).json
```

## 🐛 故障排查

### 问题1：API调用失败

```
Error: Request failed with status 401
```

**解决：** 检查API Key是否正确
```bash
echo $QWEN_API_KEY  # 验证环境变量
export QWEN_API_KEY=sk-xxx  # 重新设置
```

### 问题2：生成内容为空

```
"content": {"zh": "", "en": "", "ja": ""}
```

**解决：** 检查上下文传递，查看日志
```bash
cargo run --example marketing_generator 2>&1 | tee debug.log
grep "响应内容" debug.log
```

### 问题3：图片生成失败

```
❌ 生成失败: Invalid prompt
```

**解决：** 检查提示词长度和内容
```python
# 提示词不能太短或太长
if len(prompt) < 10:
    prompt = f"A professional photo of {prompt}"
if len(prompt) > 1000:
    prompt = prompt[:1000]
```

### 问题4：并行处理未生效

```
# 三个Agent串行执行而非并行
```

**解决：** 检查edges配置，确保三个语言生成器都直接连接到 `agent_risk_reviewer`:
```json
{
  "from": "agent_risk_reviewer",
  "to": "agent_chinese_generator"
},
{
  "from": "agent_risk_reviewer",
  "to": "agent_english_generator"
},
{
  "from": "agent_risk_reviewer",
  "to": "agent_japanese_generator"
}
```

## 📚 相关文档

- [系统设计文档](./智能营销内容生成系统设计.md)
- [交付报告](./营销内容生成系统-交付报告.md)
- [图片生成技术限制说明](./图片生成技术限制说明.md)
- [图片生成集成说明](./图片生成集成说明.md)

## 💡 最佳实践

1. **先测试后批量**：用一个产品测试流程，确认无误后再批量处理
2. **保存所有输出**：每次运行都保存JSON结果，便于追踪和复用
3. **版本控制提示词**：将优秀的prompt保存到git仓库
4. **监控API成本**：记录每次调用，控制费用
5. **人工最终审核**：AI生成内容仅供参考，发布前需人工确认

## 🎓 学习资源

- AgentFlow 框架文档：`docs/README.md`
- 通义千问API文档：https://help.aliyun.com/zh/dashscope/
- Rust异步编程：https://rust-lang.github.io/async-book/

---

**祝您使用愉快！如有问题，请查阅相关文档或联系支持团队。** 🚀

